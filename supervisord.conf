[supervisord]
nodaemon=true
logfile=/dev/null

; ───────────────────────────────────────────────────────
; Start MongoDB
; ───────────────────────────────────────────────────────
[program:mongodb]
command=mongod --dbpath /data/db --bind_ip_all --port 27017
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ───────────────────────────────────────────────────────
; Run migrations once on startup
; ───────────────────────────────────────────────────────
[program:migrate]
command=python manage.py migrate --noinput
directory=/app/backend
autostart=true
autorestart=false
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ───────────────────────────────────────────────────────
; Serve Django via Gunicorn
; ───────────────────────────────────────────────────────
[program:gunicorn]
command=gunicorn militex.wsgi:application --bind 0.0.0.0:8000 --workers 3
directory=/app/backend
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
